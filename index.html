<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è½»Bç«™</title>
    <!-- æç®€æ ·å¼ï¼Œé€‚é…è€è®¾å¤‡ï¼Œå…¨äº’åŠ¨åé¦ˆ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background-color: #f4f4f4;
            padding-bottom: 80px;
        }
        /* é¡¶éƒ¨å¯¼èˆªï¼ˆ1:1è¿˜åŸä½ çš„åŸæœ‰æ ‡è¯†ï¼‰ */
        .header {
            background: #fff;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .logo {
            width: 36px;
            height: 36px;
            background: #FB7299;
            border-radius: 8px;
            color: #fff;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .title {
            font-size: 18px;
            font-weight: bold;
        }
        .user-tag {
            font-size: 12px;
            color: #666;
            margin-left: 4px;
        }
        .version {
            font-size: 12px;
            color: #999;
            background: #f1f1f1;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 4px;
        }
        /* çƒ­é—¨æ ‡é¢˜åŒº+åˆ·æ–°æŒ‰é’®åé¦ˆ */
        .hot-title {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .hot-title h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        /* åˆ·æ–°æŒ‰é’®æ ¸å¿ƒæ ·å¼ï¼Œå…¨çŠ¶æ€åé¦ˆ */
        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            color: #FB7299;
            border: none;
            background: #fff;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        /* æŒ‰ä¸‹ç¬é—´çš„åé¦ˆ */
        .refresh-btn:active {
            transform: scale(0.95);
            background: #FB729915;
        }
        /* åˆ·æ–°ä¸­çš„çŠ¶æ€ */
        .refresh-btn.loading {
            color: #999;
            background: #f1f1f1;
            cursor: not-allowed;
        }
        .refresh-btn.loading .refresh-icon {
            animation: rotate 0.6s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* åˆ·æ–°æˆåŠŸæç¤º */
        .success-tip {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: #10b981;
            color: #fff;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 99;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .success-tip.show {
            opacity: 1;
        }
        /* åŠ è½½/é”™è¯¯çŠ¶æ€ */
        .status-box {
            padding: 60px 20px;
            text-align: center;
            color: #666;
        }
        .error-box button {
            margin-top: 12px;
            padding: 8px 16px;
            background: #FB7299;
            color: #fff;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .error-box button:active {
            transform: scale(0.95);
            background: #F1497E;
        }
        /* è§†é¢‘åˆ—è¡¨ */
        .video-list {
            padding: 0 12px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .video-card {
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            text-decoration: none;
            color: #333;
            transition: all 0.2s;
        }
        .video-card:active {
            transform: scale(0.98);
        }
        .video-cover {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            overflow: hidden;
        }
        .video-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .duration {
            position: absolute;
            bottom: 6px;
            right: 6px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            font-size: 12px;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .video-info {
            padding: 8px;
        }
        .video-title {
            font-size: 14px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 6px;
        }
        .video-meta {
            font-size: 12px;
            color: #999;
            display: flex;
            justify-content: space-between;
        }
        /* åº•éƒ¨å¯¼èˆªï¼ˆ1:1è¿˜åŸä½ çš„åŸæœ‰Tabï¼‰ */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #fff;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
            z-index: 10;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: #999;
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-item.active {
            color: #FB7299;
        }
        .nav-item:active {
            transform: scale(0.95);
            background: #f1f1f1;
        }
        .nav-item .icon {
            font-size: 20px;
        }
        /* å¼€å‘ä¸­æç¤ºé¡µï¼ˆ1:1è¿˜åŸä½ çš„åŸæœ‰æ–‡æœ¬ï¼‰ */
        .dev-tip {
            padding: 40px 20px;
            text-align: center;
            color: #666;
            display: none;
        }
        /* éšè—å·¥å…·ç±» */
        .hidden {
            display: none !important;
        }
    </style>
    <!-- å›¾æ ‡åº“ï¼Œå…¼å®¹è€è®¾å¤‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ä¿ç•™ä½ åŸæœ‰çš„PWAé…ç½® -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#FB7299">
</head>
<body>
    <!-- åˆ·æ–°æˆåŠŸæç¤º -->
    <div class="success-tip" id="successTip">åˆ·æ–°æˆåŠŸï¼Œå·²æ›´æ–°æœ€æ–°çƒ­é—¨æ•°æ®</div>

    <!-- é¡¶éƒ¨å¯¼èˆªï¼ˆ1:1è¿˜åŸä½ çš„åŸæœ‰é¡µé¢ï¼‰ -->
    <header class="header">
        <div class="logo">è½»</div>
        <div class="title">æˆ‘çš„è½»Bç«™</div>
        <div class="user-tag">ç¼–ç¨‹å°ç™½</div>
        <div class="version">v1.0</div>
    </header>

    <!-- é¦–é¡µå†…å®¹ -->
    <main id="home-page" class="page-content">
        <div class="hot-title">
            <h2>ğŸ”¥ ä»Šæ—¥çƒ­é—¨</h2>
            <button class="refresh-btn" id="refreshBtn">
                <span class="refresh-icon"><i class="fas fa-sync-alt"></i></span>
                <span class="refresh-text">åˆ·æ–°</span>
            </button>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="status-box" id="loadingBox">
            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 8px;"></i>
            <p>æ­£åœ¨åŠ è½½çƒ­é—¨å†…å®¹...</p>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ï¼ˆ1:1è¿˜åŸä½ çš„åŸæœ‰æç¤ºæ–‡æœ¬ï¼‰ -->
        <div class="status-box error-box hidden" id="errorBox">
            <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 8px; color: #FB7299;"></i>
            <p>ç½‘ç»œåŠ è½½å¤±è´¥(å¯ç¨ååˆ·æ–°)</p>
            <button id="retryBtn">ç«‹å³åˆ·æ–°</button>
        </div>

        <!-- è§†é¢‘åˆ—è¡¨ -->
        <div class="video-list hidden" id="videoList"></div>
    </main>

    <!-- æœç´¢é¡µï¼ˆè¿˜åŸåŸæœ‰å ä½æ–‡æœ¬ï¼‰ -->
    <div class="dev-tip page-content" id="search-page">
        <i class="fas fa-search" style="font-size: 30px; margin-bottom: 12px;"></i>
        <h3>æœç´¢ç»“æœ</h3>
        <p style="margin: 8px 0;">åŠŸèƒ½å¼€å‘ä¸­...</p>
    </div>

    <!-- åŠ¨æ€é¡µï¼ˆè¿˜åŸåŸæœ‰å ä½æ–‡æœ¬ï¼‰ -->
    <div class="dev-tip page-content" id="dynamic-page">
        <i class="fas fa-bell" style="font-size: 30px; margin-bottom: 12px;"></i>
        <h3>åŠ¨æ€åŠŸèƒ½å¼€å‘ä¸­...</h3>
    </div>

    <!-- æˆ‘çš„é¡µï¼ˆè¿˜åŸåŸæœ‰å ä½æ–‡æœ¬ï¼‰ -->
    <div class="dev-tip page-content" id="mine-page">
        <i class="fas fa-user" style="font-size: 30px; margin-bottom: 12px;"></i>
        <h3>æˆ‘çš„ç©ºé—´å¼€å‘ä¸­...</h3>
    </div>

    <!-- åº•éƒ¨å¯¼èˆªï¼ˆ1:1è¿˜åŸä½ çš„åŸæœ‰Tabï¼‰ -->
    <nav class="nav-bar">
        <a class="nav-item active" data-page="home-page">
            <span class="icon"><i class="fas fa-home"></i></span>
            <span>é¦–é¡µ</span>
        </a>
        <a class="nav-item" data-page="search-page">
            <span class="icon"><i class="fas fa-search"></i></span>
            <span>æœç´¢</span>
        </a>
        <a class="nav-item" data-page="dynamic-page">
            <span class="icon"><i class="fas fa-bell"></i></span>
            <span>åŠ¨æ€</span>
        </a>
        <a class="nav-item" data-page="mine-page">
            <span class="icon"><i class="fas fa-user"></i></span>
            <span>æˆ‘çš„</span>
        </a>
    </nav>

    <!-- æ ¸å¿ƒJSé€»è¾‘ï¼Œå®Œå…¨åŒ¹é…ä½ çš„åˆ·æ–°éœ€æ±‚ -->
    <script>
        // å…¨å±€å…ƒç´ è·å–
        const refreshBtn = document.getElementById('refreshBtn');
        const refreshText = refreshBtn.querySelector('.refresh-text');
        const retryBtn = document.getElementById('retryBtn');
        const loadingBox = document.getElementById('loadingBox');
        const errorBox = document.getElementById('errorBox');
        const videoList = document.getElementById('videoList');
        const successTip = document.getElementById('successTip');
        const navItems = document.querySelectorAll('.nav-item');
        const allPages = document.querySelectorAll('.page-content');

        // æ ¸å¿ƒé…ç½®
        const PROXY_URL = 'https://api.allorigins.win/raw?url=';
        // Bç«™çƒ­é—¨APIï¼ŒåŠ æ—¶é—´æˆ³é˜²ç¼“å­˜ï¼Œä¿è¯æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯æœ€æ–°çš„
        const BILIBILI_API = 'https://api.bilibili.com/x/web-interface/ranking/v2?rid=0&type=all';
        // ç”¨äºä¸­æ–­ä¸Šä¸€æ¬¡æœªå®Œæˆçš„è¯·æ±‚ï¼Œé¿å…é‡å¤è¯·æ±‚ä¹±åº
        let abortController = null;

        // å·¥å…·å‡½æ•°
        function formatNum(num) {
            if (!num) return '0';
            if (num >= 100000000) return (num / 100000000).toFixed(1) + 'äº¿';
            if (num >= 10000) return (num / 10000).toFixed(1) + 'ä¸‡';
            return num.toString();
        }
        function formatDuration(seconds) {
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            return `${m}:${String(s).padStart(2, '0')}`;
        }
        // åˆ·æ–°æˆåŠŸæç¤º
        function showSuccessTip() {
            successTip.classList.add('show');
            setTimeout(() => {
                successTip.classList.remove('show');
            }, 1500);
        }

        // ========== æ ¸å¿ƒåˆ·æ–°å‡½æ•°ï¼šä½ æŒ‰ä¸€æ¬¡ï¼Œå°±æ‰§è¡Œä¸€æ¬¡å®Œæ•´çš„åˆ·æ–°+è¯·æ±‚ ==========
        async function refreshHotData() {
            // 1. ç‚¹å‡»ç¬é—´ï¼šç«‹åˆ»ç»™åé¦ˆï¼Œé‡ç½®é¡µé¢çŠ¶æ€
            refreshBtn.classList.add('loading');
            refreshText.textContent = 'åˆ·æ–°ä¸­...';
            // ä¸­æ–­ä¸Šä¸€æ¬¡æœªå®Œæˆçš„è¯·æ±‚ï¼Œä¿è¯åªä¿ç•™æœ€æ–°çš„è¯·æ±‚
            if (abortController) abortController.abort();
            abortController = new AbortController();
            // æ¸…ç©ºæ—§è§†é¢‘å†…å®¹ï¼Œé‡ç½®æ˜¾ç¤ºçŠ¶æ€ï¼Œè®©ä½ çœ‹åˆ°é¡µé¢æ­£åœ¨åˆ·æ–°
            videoList.innerHTML = '';
            videoList.classList.add('hidden');
            errorBox.classList.add('hidden');
            loadingBox.classList.remove('hidden');

            try {
                // 2. å‘èµ·å…¨æ–°çš„Bç«™æ•°æ®è¯·æ±‚ï¼ŒåŠ æ—¶é—´æˆ³å¼ºåˆ¶ä¸ç¼“å­˜
                const fullApiUrl = `${BILIBILI_API}&t=${Date.now()}`;
                const res = await fetch(PROXY_URL + encodeURIComponent(fullApiUrl), {
                    signal: abortController.signal
                });
                if (!res.ok) throw new Error('è¯·æ±‚å¤±è´¥');
                
                const data = await res.json();
                if (data.code !== 0 || !data.data?.list) throw new Error('æ•°æ®è·å–å¤±è´¥');

                // 3. è¯·æ±‚æˆåŠŸï¼šæ¸²æŸ“å…¨æ–°çš„å†…å®¹ï¼Œåˆ·æ–°é¡µé¢
                const videoData = data.data.list;
                videoList.innerHTML = videoData.map(item => `
                    <a class="video-card" href="https://www.bilibili.com/video/${item.bvid}" target="_blank" title="${item.title}">
                        <div class="video-cover">
                            <img src="${item.pic}@480w_300h.webp" alt="${item.title}" loading="lazy">
                            <span class="duration">${formatDuration(item.duration)}</span>
                        </div>
                        <div class="video-info">
                            <div class="video-title">${item.title}</div>
                            <div class="video-meta">
                                <span><i class="fas fa-play" style="margin-right: 2px;"></i>${formatNum(item.stat.view)}</span>
                                <span><i class="fas fa-comment-dots" style="margin-right: 2px;"></i>${formatNum(item.stat.danmaku)}</span>
                            </div>
                        </div>
                    </a>
                `).join('');

                // 4. åˆ·æ–°å®Œæˆï¼šæ›´æ–°çŠ¶æ€ï¼Œç»™æˆåŠŸåé¦ˆ
                loadingBox.classList.add('hidden');
                videoList.classList.remove('hidden');
                showSuccessTip();

            } catch (err) {
                // å¿½ç•¥ä¸»åŠ¨ä¸­æ–­çš„è¯·æ±‚æŠ¥é”™
                if (err.name === 'AbortError') return;
                console.error('åˆ·æ–°å¤±è´¥ï¼š', err);
                // è¯·æ±‚å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯æç¤º
                loadingBox.classList.add('hidden');
                errorBox.classList.remove('hidden');
            } finally {
                // æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½é‡ç½®æŒ‰é’®çŠ¶æ€
                refreshBtn.classList.remove('loading');
                refreshText.textContent = 'åˆ·æ–°';
                abortController = null;
            }
        }

        // ========== äº‹ä»¶ç»‘å®šï¼šæŒ‰ä¸€æ¬¡åˆ·æ–°æŒ‰é’®ï¼Œå°±æ‰§è¡Œä¸€æ¬¡åˆ·æ–°è¯·æ±‚ ==========
        refreshBtn.addEventListener('click', refreshHotData);
        retryBtn.addEventListener('click', refreshHotData);

        // åº•éƒ¨å¯¼èˆªTabåˆ‡æ¢
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const targetPage = item.getAttribute('data-page');
                allPages.forEach(page => page.classList.add('hidden'));
                document.getElementById(targetPage).classList.remove('hidden');
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
            });
        });

        // é¡µé¢åŠ è½½å®Œæˆï¼Œè‡ªåŠ¨æ‰§è¡Œç¬¬ä¸€æ¬¡åˆ·æ–°è¯·æ±‚
        window.addEventListener('DOMContentLoaded', () => {
            refreshHotData();
            // ä¿ç•™PWAåŠŸèƒ½
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js').catch(() => {});
            }
        });
    </script>
</body>
</html>
